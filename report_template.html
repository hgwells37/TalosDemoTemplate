<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>{{ dataset_name }} - Data Validation Report</title>
 <style>
    /* Base Tufte CSS */
    html { font-size: 15px; }

   body {
    width: 100%;
    color: #111;
    max-width: 2530px;
    overflow-x: none;
    counter-reset: sidenote-counter;
    background-color: #fffff8;
    font-family: et-book, Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;
    display: flex;
}
/* Scrollable table wrapper for large tables */
.scrollable-table {
    overflow-x: auto;
    max-width: 100%;
}
/* Layout adjustments */
#main-content {
    margin-left: 0%;
    width: 80%; /* Adjusted for majority screen usage */
}
#sidebar {
    position: -webkit-sticky;
    position: sticky;
    top: 0;
    max-width: 19%;
    padding: 1rem;
    background-color: #f4f4f4;
    height: 100vh;
    overflow-y: auto;
    width:16%;
    overflow-x:hidden;
    font-size: 1.2rem;
    font-family: et-book, Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;
}
/* Sticky Sidebar */
#sidebar ul {
    list-style-type: none;
    padding-left: 0;
}
#sidebar li {
    padding: 0.35rem 0;
}
#sidebar a {
    all: unset;
    color: #111;
    text-decoration: none !important;
    font-family: et-book, Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;
}
#sidebar a:hover {
    text-decoration: underline !important;
}
#sidebar .sidebar-section {
    font-weight: bold;
    font-size: large;
}
#sidebar .sidebar-subsection {
    margin-left: 1rem;
    font-weight: normal;
    font-size: medium;
}
/* Typography */
h1.title {
    font-weight: 400;
    margin-top: 4rem;
    margin-bottom: 1.5rem;
    font-size: 3.2rem;
    line-height: 1;
}
h1 {
    font-weight: 400;
    margin-top: 2.1rem;
    margin-bottom: 0;
    font-size: 2.2rem;
    line-height: 1;
}
h2 {
    font-weight: 400;
    font-style: italic;
    font-size: 1.7rem;
    margin-bottom: 0;
    line-height: 1;
}
h3.subtitle {
    font-weight: 400;
    font-style: italic;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-size: 1.8rem;
    display: block;
    line-height: 1;
}
h3 {
    font-weight: 400;
    font-style: italic;
    font-size: 1.5rem;
    margin-top: 1.5rem;
    margin-bottom: 0;
    line-height: 1;
}
h4 {
    font-weight: 400;
    font-style: italic;
    font-size: 1.3rem;
    margin-top: 1.3rem;
    margin-bottom: 0.5rem;
    line-height: 1;
}
h4.author, h4.date {
    font-size: 1.4rem;
    font-weight: 400;
    margin: 1rem auto;
    line-height: 1;
}
/* Layout */
article {
    position: relative;
    padding: 0rem 0rem 0rem 5rem;
}
p, ol, ul { font-size: 1.4rem; }
p {
    line-height: 2rem;
    margin-top: 1.4rem;
    margin-bottom: 1.4rem;
    padding-right: 0;
    vertical-align: baseline;
    width: 100%;
}
/* Tables */
table { width: 100%; border-collapse: collapse; margin: 20px 0; }
.table-caption {
    margin-top: 0.5rem;
    text-align: center;
    font-style: italic;
}
.table-label {
    font-weight: bold;
    font-style: normal;
}
th, td { border: 1px solid #ddd; padding: 8px; text-align: left; white-space: nowrap; }
th { background-color: #f4f4f4; cursor: pointer; position: relative; }
.table-container { overflow-x: auto; max-width: 100%; }
.figure { text-align: center; margin: 20px 0; }
/* Tooltip for long header text */
th[title]:hover::after {
    content: attr(title);
    display: block;
    position: absolute;
    background: #444;
    color: white;
    padding: 5px;
    border-radius: 3px;
    top: 100%;
    left: 0;
    white-space: nowrap;
    z-index: 10;
}

/* Lists */
ol, ul {
    width: 100%;
    -webkit-padding-start: 5%;
    -webkit-padding-end: 5%;
}
li { padding: 0.5rem 0; }
/* Images and figures */
img {max-width: 100%;}
div.figure {
    padding: 0;
    border: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
    max-width: 100%;
    -webkit-margin-start: 0;
    -webkit-margin-end: 0;
    margin: 0 0 3em 0;
}
figure {
    margin: 2rem 0;
    text-align: center;
}
figure img {
    max-width: 70%;
    display: block;
    margin: 0 auto;
}
.figure-label {
    font-weight: bold;
    font-style: normal;
}
figcaption {
    font-style: italic;
    font-weight: normal;
    margin-top: 0.5rem;
    text-align: center;
}
/* Other special elements */
hr {
    margin-left: 0;
    width: 55%;
    margin: 2rem 0;
}
.fullwidth {
    max-width: 90%;
    clear: both;
}
/* Visualization containers */
.viz-container {
    width: 100%;
    margin: 2rem 0;
}
#references {
  font-size: 13px;
  line-height: 1.6;
}

/* Data Validation Specific Styles */
.summary-box {
    background-color: #f8f9fa;
    border-left: 4px solid #0066cc;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 0 5px 5px 0;
}

.introduction-box {
    background-color: #e8f4fd;
    border-left: 4px solid #2196F3;
    padding: 20px;
    margin-bottom: 25px;
    border-radius: 0 8px 8px 0;
}

.story-transition {
    background-color: #fff3cd;
    border-left: 4px solid #ffc107;
    padding: 15px;
    margin: 25px 0;
    border-radius: 0 5px 5px 0;
    font-style: italic;
}


.section-description {
    background-color: #f0f4f8;
    border-left: 4px solid #0066cc;
    padding: 15px;
    margin-bottom: 20px;
    font-style: italic;
    color: #333;
}

.issues-summary {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-bottom: 20px;
}

.issue-counter {
    flex: 1;
    min-width: 200px;
    padding: 15px;
    border-radius: 5px;
    color: white;
    text-align: center;
}

.high {
    background-color: #e49da4;
}

.medium {
    background-color: #fab57c;
}

.low {
    background-color: #8fd8a0;
}

.severity-high {
    color: #e49da4;
    font-weight: bold;
}

.severity-medium {
    color: #fab57c;
    font-weight: bold;
}

.severity-low {
    color: #8fd8a0;
    font-weight: bold;
}

.data-preview {
    overflow-x: auto;
}

.analysis-insights {
    background-color: #f8f9fa;
    padding: 15px;
    border-radius: 5px;
    margin-top: 15px;
}

.analysis-insights h3 {
    color: #0066cc;
    margin-top: 0;
}

.validation-summary {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 20px;
}

.validation-stat {
    flex: 1;
    min-width: 180px;
    padding: 15px;
    border-radius: 5px;
    background-color: #f8f9fa;
    border-left: 4px solid #0066cc;
    text-align: center;
}

.validation-stat h3 {
    margin-top: 0;
    color: #0066cc;
}

.validation-stat p {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 0;
}

.validation-grid {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}

.validation-grid th {
    background-color: #f2f2f2;
    text-align: center;
    padding: 12px 8px;
    font-size: 0.9em;
    vertical-align: bottom;
    word-break: break-word;
}

.validation-grid td {
    text-align: center;
    padding: 10px 5px;
}

.issue-type-table {
    margin-top: 30px;
}

.status-high {
    background-color: #e49da4;
    padding: 5px;
    border-radius: 3px;
}

.status-medium {
    background-color: #fab57c;
    padding: 5px;
    border-radius: 3px;
}

.status-low {
    background-color: #8fd8a0;
    padding: 5px;
    border-radius: 3px;
}

.first-col {
    font-weight: bold;
    text-align: left !important;
}

.check-ok {
    color: #28a745;
}

.issue-alert {
    color: #dc3545;
}

.issue-warning {
    color: #fd7e14;
}

/* Issue type percentages */
.issue-type-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
}

.issue-stat {
    flex: 1;
    min-width: 150px;
    padding: 15px;
    border-radius: 5px;
    background-color: #f8f9fa;
    border-left: 4px solid #6c757d;
    text-align: center;
}

.issue-stat h4 {
    margin-top: 0;
    color: #555;
    font-size: 0.9em;
}

.issue-stat p {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 0;
}

.progress-container {
    width: 100%;
    background-color: #e9ecef;
    height: 8px;
    border-radius: 4px;
    margin-top: 8px;
}

.progress-bar {
    height: 8px;
    border-radius: 4px;
    /* background-color: #28a745; */
}

.progress-bar.progress-bar-score-high {
    background-color: #dc3545;
}

.progress-bar.progress-bar-score-medium {
    background-color: #fd7e14;
}

.progress-bar.progress-bar-score-low {
    background-color: #28a745;
}



/* Overall score */
.overall-score {
    text-align: center;
    margin: 20px 0;
    padding: 20px;
    background-color: #f0f4f8;
    border-radius: 5px;
    border-left: 4px solid #0066cc;
}

.overall-score h3 {
    margin-top: 0;
    color: #0066cc;
}

.overall-score .score-value {
    font-size: 48px;
    font-weight: bold;
    margin: 10px 0;
}

.score-good {
    color: #28a745;
}

.score-medium {
    color: #fd7e14;
}

.score-poor {
    color: #dc3545;
}

/* Overall validation progress bar */
.overall-progress-container {
    width: 100%;
    background-color: #e9ecef;
    height: 20px;
    border-radius: 10px;
    margin: 15px 0;
    overflow: hidden;
}

.overall-progress-bar {
    height: 20px;
    float: left;
}

.passed-section {
    background-color: #28a745;
}

.failed-section {
    background-color: #dc3545;
}
   
/* Key metrics cards */
.key-metrics {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    margin: 20px 0;
}

.metric-card {
    flex: 1;
    min-width: 180px;
    padding: 20px;
    border-radius: 8px;
    background-color: #ffffff;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    text-align: center;
}

.metric-card h3 {
    margin-top: 0;
    color: #333;
    font-size: 1.1rem;
}

.metric-card .metric-value {
    font-size: 2rem;
    font-weight: bold;
    margin: 10px 0;
    color: #0066cc;
}

.metric-card .metric-description {
    font-size: 0.9rem;
    color: #666;
    margin: 0;
}

/* Responsive design */
@media screen and (max-width: 760px) {
    body {
        display: block;
    }
    #sidebar {
        position: static;
        width: 100%;
        height: auto;
    }
    #main-content {
        width: 100%;
    }
    p, footer, ol, ul, table, hr { width: 90%; }
    pre { width: 87.5%; }
    ul { width: 85%; }
    figure { max-width: 90%; }
    div.fullwidth p.caption { max-width: none; }
    label { cursor: pointer; }
    div.figure { max-width: 90%; }
    pre {
        width: 90%;
        padding: 0;
    }
    .issues-summary, .issue-type-stats, .key-metrics {
        flex-direction: column;
    }
     .issue-counter, .issue-stat, .metric-card {
        min-width: auto;
    }
}
</style>
</head>

<body>
    <div id="sidebar">
        <ul>
            <li class="sidebar-section"><a href="#introduction">Introduction</a></li>
            <li class="sidebar-section"><a href="#dataset-overview">Dataset Overview</a></li>
            <li class="sidebar-section"><a href="#data-preview">Data Preview</a></li>
            <li class="sidebar-section"><a href="#data-dictionary-analysis">Data Dictionary Analysis</a></li>
          <li class="sidebar-section"><a href="#key-findings">Key Findings</a></li>
          <li class="sidebar-section"><a href="#data-quality-validation-results">Data Validation Results</a></li>
            <li class="sidebar-section"><a href="#recommendations">Recommendations</a></li>
          
        </ul>
    </div>

    <div id="main-content">
        <article>
            <h1 class="title">Data Validation Report</h1>
            <h3 class="subtitle">Quality Assessment for <strong>{{ dataset_name }}</strong></h3>
            <h4 class="author">Generated: <strong>{{ generation_date }}</strong></h4>
            <h4 class="date" id="current-date"></h4>
             <section id="introduction">
                <h1>Introduction</h1>
                <div class="introduction-box">

                    <p>This comprehensive data quality assessment validates the dataset's readiness for analytical modeling and statistical analysis. As a data scientist, you need reliable, clean data before proceeding with feature engineering, model development, or predictive analytics—this report identifies critical quality issues that could compromise your analytical outcomes and provides prioritized recommendations for remediation.</p>
                </div>
            </section>
            <section id="dataset-overview">
                <h1>Dataset Overview</h1>
                <div class="section-description">
                    Let's start by understanding what we're working with. Here's a snapshot of your dataset's basic characteristics.
                </div>
                <div class="key-metrics">
                    <div class="metric-card">
                        <h3>Dataset Size</h3>
                        <div class="metric-value">{{ row_count }}</div>
                        <p class="metric-description">Total Records</p>
                    </div>
                    <div class="metric-card">
                        <h3>Data Fields</h3>
                        <div class="metric-value">{{ column_count }}</div>
                        <p class="metric-description">Columns</p>
                    </div>
                    <div class="metric-card">
                        <h3>File Size</h3>
                        <div class="metric-value">{{ file_size }}</div>
                        <p class="metric-description">Storage Required</p>
                    </div>
                    <div class="metric-card">
                        <h3>Format</h3>
                        <div class="metric-value">{{ data_format }}</div>
                        <p class="metric-description">Data Type</p>
                    </div>
                </div>
                <table>
                    <tr><th>Attribute</th><th>Value</th></tr>
                    <tr><td>Dataset Name</td><td>{{ dataset_name }}</td></tr>
                    <tr><td>Last Updated</td><td>{{ last_updated }}</td></tr>
                    <tr><td>Dictionary Status</td><td>{{ dictionary_status }}</td></tr>
                </table>
            </section>
                
            <section id="data-preview">
                <h1>Data Preview</h1>
                <div class="section-description">
                     Here's your first look at the actual data. This preview shows the structure and sample values to help you understand what we're validating.
                </div>
              
                <div class="data-preview" style="overflow-x: auto;">
                    {{ df_preview_html | safe }}
                </div>
              <h2>Meta Data</h2>
                <div class="section-description">
                    The following schema analysis provides a comprehensive assessment of the dataset's structural composition, datatypes, and completeness metrics essential for analytical validation.
                </div>
                <div class="data-preview" style="overflow-x: auto;">
                    {{ data_type_html | safe }}
                </div>
              <div class="story-transition">  
                    <p><strong>What's Next:</strong> Now that we've seen the data, let's examine the blueprint we're using to validate it - your data dictionary.</p>
                </div>
            </section>
            <section id="data-dictionary-analysis">
                <h1>Data Dictionary Analysis</h1>
                <div class="section-description">
                    The data dictionary serves as our validation blueprint. It defines what each field should contain, its format, and constraints. Let's examine both the original specifications and what we discovered.
                </div>
                <h2>Original Specifications</h2>
                <div class="section-description">
                    provided by the User, detailing the metadata for each column in the dataset.
                </div>
              <div class="data-preview" style="overflow-x: auto;">
                    {{ original_data_dictionary_html | safe }}
                </div>
                <h2>Dictionary Issues Found</h2>
                <div class="section-description">
                    This section compares the provided data dictionary against the actual dataset to identify any discrepancies.Here's what needed clarification or correction.
                </div>
              <div class="data-preview" style="overflow-x: auto;">

                    {{ data_dictionary_issues_html | safe }}
                </div>
                <h2>Refined Dictionary</h2>
                <div class="section-description">
                    Based on our analysis, here's the corrected and validated data dictionary we used for validation.
                </div>
                <div class="data-preview" style="overflow-x: auto;">
                    {{ validated_data_dictionary_html | safe }}
                </div>
              <div class="story-transition">
                    <p><strong>What's Next:</strong> With a clear understanding of expectations, let's see how your data measures up.</p>
                </div>
            </section>

            <section id="detailed-analysis">
              <section id="key-findings">
                <h1>Key Findings</h1>
                <div class="section-description">
                    Here's what our validation uncovered. We've categorized issues by severity to help you prioritize your response.
                  <br><br>
    <strong>•</strong> categorized the identified data quality issues by severity, aligned with predefined definitions to guide prioritization and remediation efforts.
                </div>
                <div class="issues-summary">
                    <div class="issue-counter high">
                        <h3>{{ high_count }} Critical Issues</h3>
                        <p>Must be addressed immediately</p>
                    </div>
                    <div class="issue-counter medium">
                        <h3>{{ medium_count }} Medium Issues</h3>
                        <p>Should be resolved soon</p>
                    </div>
                    <div class="issue-counter low">
                        <h3>{{ low_count }} Low Issues</h3>
                        <p>Good to fix for optimization</p>
                    </div>
                </div>
                <div class="story-transition">
                    <p><strong>Note:</strong> {{ fields_with_issues }} out of {{ total_fields }} fields have issues that need attention. Let's dive deeper into what we found.</p>
                </div>
            </section>
              </section>
              <section id="data-quality-validation-results" class="section">
                <h1>Data Validation Results</h1>
                <div class="section-description">

                    This section presents comprehensive validation results comparing the actual dataset against the data dictionary specifications. Each failed validation check is documented with specific examples showing the problematic data entries. The results are categorized by validation type, with detailed breakdowns of failure instances to facilitate targeted data remediation efforts.

                </div>
                <h2>Summary</h2>
                <div class="section-description">
                    Overview of all data quality checks performed, showing pass(<strong>✓</strong>) / fail(<strong>x</strong>) status and quantified failure details for each validation category.<br><br>
                  <strong>Note:</strong> The "Failed details" column uses the format:
{FieldName – FailedRowCount}<br>
This indicates which field failed the validation and how many rows were affected.
                </div>
                <div class="data-preview" style="overflow-x: auto;">
                    {{ validation_results_html | safe }}
                </div>
                <h2>Failed Records</h2>
<div class="section-description">
    A preview of the dataset will be displayed, showcasing the rows that failed validation. This preview will contain the original columns from the dataset, but failed cells (that did not meet the validation requirements) will be highlighted for easy identification.
</div>

<!-- Filter Controls -->
<div style="margin: 20px 0; display: flex; flex-wrap: wrap; gap: 1rem;">
    <div>
        <label for="issueFilter"><strong>Filter by Issue Type:</strong></label><br>
        <select id="issueFilter">
            <option value="all">All</option>
            <option value="Data type mismatches">Data type mismatches</option>
            <option value="Missing or extra columns">Missing or extra columns</option>
            <option value="Nullability violations">Nullability violations</option>
            <option value="Out-of-range values">Out-of-range values</option>
            <option value="Format errors">Format errors</option>
            <option value="Uniqueness violations">Uniqueness violations</option>
            <option value="Reference integrity issues">Reference integrity issues</option>
            <option value="Cross-field inconsistencies">Cross-field inconsistencies</option>
            <option value="Chronological errors">Chronological errors</option>
            <option value="Standardization problems">Standardization problems</option>
        </select>
    </div>
    <div>
        <label for="fieldFilter"><strong>Filter by Field Name:</strong></label><br>
        <select id="fieldFilter">
            <option value="all">All</option>
            {% for field in failed_fields %}
            <option value="{{ field }}">{{ field }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<!-- Table -->
<div class="data-preview scrollable-table" id="failedDataPreview">
    {{ df_preview_issues_html | safe }}
</div>

<!-- JS Filter Logic and Pagination -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Filter logic for failed records table
    const issueFilter = document.getElementById('issueFilter');
    const fieldFilter = document.getElementById('fieldFilter');

    function applyFilters() {
        const selectedIssue = issueFilter.value;
        const selectedField = fieldFilter.value;
        const rows = document.querySelectorAll('#failedDataPreview tr[data-issue-type]');

        rows.forEach(row => {
            const issueType = row.getAttribute('data-issue-type');
            const fieldName = row.getAttribute('data-field-name');

            const issueMatch = (selectedIssue === 'all' || issueType === selectedIssue);
            const fieldMatch = (selectedField === 'all' || fieldName === selectedField);

            row.style.display = (issueMatch && fieldMatch) ? '' : 'none';
        });
    }

    if (issueFilter && fieldFilter) {
        issueFilter.addEventListener('change', applyFilters);
        fieldFilter.addEventListener('change', applyFilters);
    }

    // Pagination for large tables (>30 rows)
    const tables = document.querySelectorAll('.data-preview table');

    tables.forEach((table, index) => {
        const rows = table.querySelectorAll('tbody tr');
        if (rows.length > 30) {
            let currentPage = 0;
            const rowsPerPage = 30;

            const paginate = () => {
                rows.forEach((row, i) => {
                    row.style.display = (i >= currentPage * rowsPerPage && i < (currentPage + 1) * rowsPerPage) ? '' : 'none';
                });
            };

            const paginationControls = document.createElement('div');
            paginationControls.style.margin = '10px 0';
            paginationControls.innerHTML = `
                <button class="prev-page">Previous</button>
                <span class="page-info">Page 1</span>
                <button class="next-page">Next</button>
            `;

            const prevBtn = paginationControls.querySelector('.prev-page');
            const nextBtn = paginationControls.querySelector('.next-page');
            const pageInfo = paginationControls.querySelector('.page-info');

            prevBtn.addEventListener('click', () => {
                if (currentPage > 0) {
                    currentPage--;
                    paginate();
                    pageInfo.textContent = "Page " + (currentPage + 1);
                }
            });

            nextBtn.addEventListener('click', () => {
                if ((currentPage + 1) * rowsPerPage < rows.length) {
                    currentPage++;
                    paginate();
                    pageInfo.textContent = "Page " + (currentPage + 1);
                }
            });

            table.parentNode.insertBefore(paginationControls, table);
            paginate();
        }
    });

    // Smooth scrolling for anchor links in sidebar
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const target = document.getElementById(targetId);
            if (target) {
                target.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });
});
</script>
                <section id="recommendations" class="section">
                    <h2>Recommendations</h2>
                    <ul>
                        <li><strong>{{ rec_1_title }}:</strong> {{ rec_1_details }}</li>
                        <li><strong>{{ rec_2_title }}:</strong> {{ rec_2_details }}</li>
                        <li><strong>{{ rec_3_title }}:</strong> {{ rec_3_details }}</li>
                    </ul>
                </section>
    </div>
</body>
</html>